<!-- ATLAS — Intelligence Research Hub -->
<div class="tab-content" id="tab-atlas">

  <!-- Agent Hero Card -->
  <div class="agent-hero" style="--hero-accent:var(--agent-atlas);">
    <div class="agent-hero-top">
      <div class="agent-hero-icon" style="background:rgba(14,165,233,0.15);color:var(--agent-atlas);">A</div>
      <div>
        <div class="agent-hero-title">Atlas — 24/7 Intelligence Research Engine</div>
        <div class="agent-hero-role">Semantic Knowledge Base &amp; Cross-Agent Intelligence</div>
      </div>
    </div>
    <div class="agent-hero-desc">
      Atlas runs continuous 45-minute research cycles, feeding intelligence to every agent in the network.
      It maintains a <strong>semantic knowledge base</strong> with observations, learnings, and cross-agent
      insights searchable via natural language. Supports deep research queries that synthesize information
      across multiple sources. Each cycle produces actionable intelligence — market regime changes, sentiment
      shifts, emerging risks — that directly influence trading agent behavior.
    </div>
    <div class="agent-hero-caps">
      <span class="agent-cap agent-cap-highlight">24/7 Research</span>
      <span class="agent-cap">Semantic Knowledge Base</span>
      <span class="agent-cap">Natural Language Search</span>
      <span class="agent-cap">Deep Research Queries</span>
      <span class="agent-cap">Cross-Agent Intel Feed</span>
      <span class="agent-cap">45-Min Cycle Time</span>
    </div>
  </div>

  <!-- Header -->
  <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;">
    <h2 style="margin:0;font-size:1.1rem;font-weight:700;">
      Atlas &mdash; Intelligence Research Hub
    </h2>
    <span id="atlas-mode-badge" class="badge badge-success">
      <span class="status-dot online"></span> Running
    </span>
    <button class="btn" onclick="healthCheckAgent('atlas')" style="font-size:0.72rem;">Health Check</button>
    <button class="btn" onclick="atlasRefreshAll()" style="font-size:0.72rem;font-weight:700;border-color:var(--agent-atlas);color:var(--agent-atlas);margin-left:auto;">
      Refresh
    </button>
    <span class="text-muted" style="font-size:0.68rem;">
      Updated: <span id="atlas-updated">--</span>
    </span>
  </div>

  <div class="health-inline" id="atlas-health-result"></div>

  <!-- Hero Metrics -->
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px;">
    <div class="glass-card" style="text-align:center;padding:14px;">
      <div class="text-muted" style="font-size:0.64rem;text-transform:uppercase;letter-spacing:0.05em;">Uptime</div>
      <div id="atlas-uptime" style="font-size:1.4rem;font-weight:800;font-family:var(--font-mono);">--</div>
    </div>
    <div class="glass-card" style="text-align:center;padding:14px;">
      <div class="text-muted" style="font-size:0.64rem;text-transform:uppercase;letter-spacing:0.05em;">Agents Fed</div>
      <div style="display:flex;align-items:baseline;justify-content:center;gap:4px;">
        <span id="atlas-agents-fed" style="font-size:1.4rem;font-weight:800;font-family:var(--font-mono);">--</span>
        <span style="font-size:0.8rem;color:var(--text-muted);">/ <span id="atlas-feed-total">11</span></span>
      </div>
      <div style="font-size:0.6rem;color:var(--text-muted);margin-top:2px;">
        <span id="atlas-feed-starving" style="color:var(--error);">--</span> starving
      </div>
    </div>
    <div class="glass-card" style="text-align:center;padding:14px;">
      <div class="text-muted" style="font-size:0.64rem;text-transform:uppercase;letter-spacing:0.05em;">Knowledge Growth</div>
      <div id="atlas-knowledge-growth" style="font-size:1.4rem;font-weight:800;font-family:var(--font-mono);color:var(--agent-atlas);">--</div>
      <div style="font-size:0.6rem;color:var(--text-muted);">24h</div>
    </div>
    <div class="glass-card" style="text-align:center;padding:14px;">
      <div class="text-muted" style="font-size:0.64rem;text-transform:uppercase;letter-spacing:0.05em;">Research Quality</div>
      <div id="atlas-quality-score" style="font-size:1.4rem;font-weight:800;font-family:var(--font-mono);color:var(--agent-atlas);">--</div>
      <div style="font-size:0.6rem;color:var(--text-muted);margin-top:2px;">
        <span id="atlas-research-today">--</span> today &middot; <span id="atlas-research-hit">--</span> hit rate
      </div>
    </div>
  </div>

  <!-- Sub-tab Navigation -->
  <div style="display:flex;gap:6px;margin-bottom:16px;flex-wrap:wrap;">
    <button class="atlas-subtab active" data-sub="overview" onclick="atlasSwitchSub('overview')">Overview</button>
    <button class="atlas-subtab" data-sub="search" onclick="atlasSwitchSub('search')">KB Search</button>
    <button class="atlas-subtab" data-sub="research" onclick="atlasSwitchSub('research')">Deep Research</button>
    <button class="atlas-subtab" data-sub="queue" onclick="atlasSwitchSub('queue')">Priority Queue</button>
    <button class="atlas-subtab" data-sub="analysis" onclick="atlasSwitchSub('analysis')">Agent Analysis</button>
  </div>

  <!-- ═══ Panel: Overview ═══ -->
  <div class="atlas-panel" id="atlas-panel-overview">

    <!-- KB Health -->
    <div class="glass-card" style="margin-bottom:12px;border-left:3px solid var(--agent-atlas);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <span style="font-family:var(--font-mono);font-size:0.72rem;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-muted);">Knowledge Base Health</span>
        <button class="btn" onclick="loadAtlasKBHealth()" style="font-size:0.72rem;">Refresh</button>
      </div>
      <div id="atlas-kb-health-bar" style="margin-bottom:6px;">
        <div style="height:8px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden;">
          <div id="atlas-kb-bar-fill" style="height:100%;width:0%;border-radius:4px;transition:width 0.5s ease;background:var(--agent-atlas);"></div>
        </div>
      </div>
      <div id="atlas-kb-health-summary" style="display:flex;gap:12px;flex-wrap:wrap;font-size:0.7rem;"></div>
      <div style="display:flex;gap:16px;margin-top:8px;font-family:var(--font-mono);font-size:0.68rem;">
        <span><span style="color:var(--text-muted);">Obs:</span> <span id="atlas-kb-obs">--</span></span>
        <span><span style="color:var(--text-muted);">Learnings:</span> <span id="atlas-kb-learn">--</span></span>
        <span style="color:var(--warning);"><span style="color:var(--text-muted);">Stale:</span> <span id="atlas-kb-stale">--</span></span>
      </div>
    </div>

    <!-- Background Status -->
    <div id="atlas-bg-status" class="glass-card" style="margin-bottom:12px;"></div>

    <!-- Agent Activity -->
    <div class="glass-card" style="margin-bottom:12px;border-left:3px solid var(--agent-atlas);">
      <span style="font-family:var(--font-mono);font-size:0.72rem;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-muted);">Agent Activity</span>
      <div id="atlas-activity-feed" style="font-family:var(--font-mono);font-size:0.74rem;max-height:150px;overflow-y:auto;margin-top:8px;"></div>
    </div>

    <!-- Latest Insight -->
    <div id="atlas-latest-insight" class="glass-card" style="border-left:3px solid var(--agent-atlas);display:none;">
      <span style="color:var(--text-muted);font-size:0.66rem;text-transform:uppercase;letter-spacing:0.06em;">Latest Insight</span>
      <div id="atlas-insight-text" style="margin-top:4px;font-family:var(--font-mono);font-size:0.76rem;"></div>
    </div>

    <!-- Secondary Stats -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px;">
      <div class="stat-card" data-accent="atlas"><div class="stat-value" id="atlas-anomalies">--</div><div class="stat-label">Anomalies</div></div>
      <div class="stat-card" data-accent="atlas"><div class="stat-value" id="atlas-api-budget">--</div><div class="stat-label">API Budget (today)</div></div>
      <div class="stat-card" data-accent="atlas"><div class="stat-value" id="atlas-event-bus">--</div><div class="stat-label">Event Bus</div></div>
    </div>
  </div>

  <!-- ═══ Panel: KB Search ═══ -->
  <div class="atlas-panel" id="atlas-panel-search" style="display:none;">
    <div class="glass-card" style="border-left:3px solid var(--agent-atlas);">
      <span style="font-family:var(--font-mono);font-size:0.72rem;text-transform:uppercase;letter-spacing:0.06em;color:var(--agent-atlas);">KB Semantic Search</span>
      <div style="font-size:0.68rem;color:var(--text-muted);margin:6px 0 10px;">Search learnings and observations by meaning, not just keywords.</div>
      <div style="display:flex;gap:8px;align-items:center;">
        <input type="text" class="input" id="atlas-kb-search-query" placeholder="e.g. bitcoin weekend pattern, content engagement..." style="flex:1;font-size:0.78rem;padding:6px 10px;" onkeydown="if(event.key==='Enter')atlasKBSearch()">
        <button class="btn" onclick="atlasKBSearch()" style="font-size:0.76rem;padding:6px 16px;font-weight:700;border-color:var(--agent-atlas);color:var(--agent-atlas);">Search KB</button>
      </div>
      <div id="atlas-kb-search-results" style="display:none;margin-top:10px;max-height:350px;overflow-y:auto;"></div>
    </div>
  </div>

  <!-- ═══ Panel: Deep Research ═══ -->
  <div class="atlas-panel" id="atlas-panel-research" style="display:none;">
    <div class="glass-card" style="border-left:3px solid var(--agent-atlas);">
      <span style="font-family:var(--font-mono);font-size:0.72rem;text-transform:uppercase;letter-spacing:0.06em;color:var(--agent-atlas);">Deep Research</span>
      <div style="font-size:0.68rem;color:var(--text-muted);margin:6px 0 10px;">Target an agent or topic for focused intelligence gathering.</div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <select class="input" id="atlas-deep-agent" style="width:130px;font-size:0.78rem;padding:6px 10px;">
          <option value="">Any Agent</option>
          <option value="garves">Garves</option>
          <option value="hawk">Hawk</option>
          <option value="quant">Quant</option>
          <option value="soren">Soren</option>
          <option value="lisa">Lisa</option>
          <option value="shelby">Shelby</option>
          <option value="thor">Thor</option>
          <option value="robotox">Robotox</option>
          <option value="viper">Viper</option>
          <option value="odin">Odin</option>
        </select>
        <input type="text" class="input" id="atlas-deep-query" placeholder="Research topic..." style="flex:1;min-width:200px;font-size:0.78rem;padding:6px 10px;" onkeydown="if(event.key==='Enter')atlasDeepResearch()">
        <button class="btn" onclick="atlasDeepResearch()" style="font-size:0.76rem;padding:6px 16px;font-weight:700;border-color:var(--agent-atlas);color:var(--agent-atlas);">Research</button>
      </div>
      <div id="atlas-deep-result" style="display:none;margin-top:10px;padding:10px 14px;background:var(--surface-elevated);border-radius:6px;font-size:0.76rem;max-height:300px;overflow-y:auto;"></div>
    </div>
  </div>

  <!-- ═══ Panel: Priority Queue ═══ -->
  <div class="atlas-panel" id="atlas-panel-queue" style="display:none;">

    <!-- Summary Cards -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:14px;">
      <div class="glass-card" style="text-align:center;padding:14px;">
        <div class="text-muted" style="font-size:0.64rem;text-transform:uppercase;letter-spacing:0.05em;">KB Health</div>
        <div id="atlas-kb-score" style="font-size:1.4rem;font-weight:800;font-family:var(--font-mono);color:var(--agent-atlas);">--</div>
      </div>
      <div class="glass-card" style="text-align:center;padding:14px;">
        <div class="text-muted" style="font-size:0.64rem;text-transform:uppercase;letter-spacing:0.05em;">Agents Fed</div>
        <div id="atlas-feed-count" style="font-size:1.4rem;font-weight:800;font-family:var(--font-mono);color:var(--success);">--</div>
      </div>
      <div class="glass-card" style="text-align:center;padding:14px;">
        <div class="text-muted" style="font-size:0.64rem;text-transform:uppercase;letter-spacing:0.05em;">Research Quality</div>
        <div id="atlas-research-quality" style="font-size:1.4rem;font-weight:800;font-family:var(--font-mono);color:var(--agent-atlas);">--</div>
        <div style="font-size:0.6rem;color:var(--text-muted);margin-top:2px;">
          <span id="atlas-research-tavily">--</span> API calls
        </div>
      </div>
    </div>

    <!-- Queue Actions -->
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <span style="font-family:var(--font-mono);font-size:0.72rem;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-muted);">Priority Queue</span>
      <div style="display:flex;gap:6px;">
        <button class="btn" id="atlas-exec-top3-btn" onclick="atlasExecuteTop3()" style="font-size:0.72rem;font-weight:700;border-color:var(--agent-atlas);color:var(--agent-atlas);">Execute Top 3</button>
        <button class="btn" onclick="loadAtlasPriorityQueue()" style="font-size:0.72rem;">Refresh</button>
      </div>
    </div>

    <!-- Queue List -->
    <div id="atlas-priority-queue" style="display:flex;flex-direction:column;gap:6px;"></div>

    <!-- Execution Results -->
    <div id="atlas-exec-results" style="display:none;margin-top:10px;"></div>
  </div>

  <!-- ═══ Panel: Agent Analysis ═══ -->
  <div class="atlas-panel" id="atlas-panel-analysis" style="display:none;">
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;">
      <button class="btn" onclick="atlasAnalyze('garves')" style="font-size:0.68rem;">Garves</button>
      <button class="btn" onclick="atlasAnalyze('hawk')" style="font-size:0.68rem;">Hawk</button>
      <button class="btn" onclick="atlasAnalyze('odin')" style="font-size:0.68rem;">Odin</button>
      <button class="btn" onclick="atlasAnalyze('soren')" style="font-size:0.68rem;">Soren</button>
      <button class="btn" onclick="atlasAnalyze('lisa')" style="font-size:0.68rem;">Lisa</button>
      <button class="btn" onclick="atlasAnalyze('shelby')" style="font-size:0.68rem;">Shelby</button>
      <button class="btn" onclick="atlasAnalyze('viper')" style="font-size:0.68rem;">Viper</button>
      <button class="btn" onclick="atlasFullReport()" style="font-size:0.68rem;font-weight:700;border-color:var(--agent-atlas);color:var(--agent-atlas);">Full Report</button>
    </div>
    <div class="atlas-report" id="atlas-report" style="display:none;"></div>
  </div>

  <!-- Hidden compat: intel-meter + widget-badge for JS that references them -->
  <div style="display:none;">
    <div id="intel-atlas" class="intel-meter"></div>
    <div id="atlas-widgets"><div id="atlas-learning"><span>--</span></div></div>
  </div>

</div>
