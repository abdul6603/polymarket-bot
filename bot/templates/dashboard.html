<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Command Center</title>
<link rel="icon" type="image/png" href="/static/soren_profile.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
<link rel="stylesheet" href="/static/dashboard.css">
</head>
<body>
<nav class="sidebar">
  <div class="sidebar-brand">CC</div>
  <div class="sidebar-divider"></div>
  <div class="sidebar-section-label">COMMAND</div>
  <button class="sidebar-btn active" data-tab="overview" onclick="switchTab('overview')" title="Overview">
    <span class="sidebar-icon" style="background:var(--text-secondary);">OV</span><span class="sidebar-label">Overview</span>
  </button>
  <button class="sidebar-btn" data-tab="system" onclick="switchTab('system')" title="System">
    <span class="sidebar-icon" style="background:#aaaaaa;">SY</span><span class="sidebar-label">System</span>
  </button>
  <div class="sidebar-divider"></div>
  <div class="sidebar-section-label">TRADING</div>
  <button class="sidebar-btn" data-tab="garves-live" onclick="switchTab('garves-live')" title="Garves">
    <span class="sidebar-icon" style="background:var(--agent-garves);">GA</span><span class="sidebar-label">Garves $</span>
  </button>
  <button class="sidebar-btn" data-tab="hawk" onclick="switchTab('hawk')" title="Hawk">
    <span class="sidebar-icon" style="background:var(--agent-hawk);">HK</span><span class="sidebar-label">Hawk $</span>
  </button>
  <button class="sidebar-btn" data-tab="quant" onclick="switchTab('quant')" title="Quant">
    <span class="sidebar-icon" style="background:var(--agent-quant);">QT</span><span class="sidebar-label">Quant</span>
  </button>
  <button class="sidebar-btn" data-tab="odin" onclick="switchTab('odin')" title="Odin">
    <span class="sidebar-icon" style="background:var(--agent-odin);">OD</span><span class="sidebar-label">Odin $</span>
  </button>
  <div class="sidebar-divider"></div>
  <div class="sidebar-section-label">CONTENT</div>
  <button class="sidebar-btn" data-tab="soren" onclick="switchTab('soren')" title="Soren">
    <span class="sidebar-icon" style="background:var(--agent-soren);">SO</span><span class="sidebar-label">Soren</span>
  </button>
  <button class="sidebar-btn" data-tab="lisa" onclick="switchTab('lisa')" title="Lisa">
    <span class="sidebar-icon" style="background:var(--agent-lisa);">LI</span><span class="sidebar-label">Lisa</span>
  </button>
  <div class="sidebar-divider"></div>
  <div class="sidebar-section-label">OPS</div>
  <button class="sidebar-btn" data-tab="shelby" onclick="switchTab('shelby')" title="Shelby">
    <span class="sidebar-icon" style="background:var(--agent-shelby);">SH</span><span class="sidebar-label">Shelby</span>
  </button>
  <button class="sidebar-btn" data-tab="atlas" onclick="switchTab('atlas')" title="Atlas">
    <span class="sidebar-icon" style="background:var(--agent-atlas);">AT</span><span class="sidebar-label">Atlas</span>
  </button>
  <button class="sidebar-btn" data-tab="sentinel" onclick="switchTab('sentinel')" title="Robotox">
    <span class="sidebar-icon" style="background:var(--agent-sentinel);">RO</span><span class="sidebar-label">Robotox</span>
  </button>
  <button class="sidebar-btn" data-tab="thor" onclick="switchTab('thor')" title="Thor">
    <span class="sidebar-icon" style="background:var(--agent-thor);">TH</span><span class="sidebar-label">Thor</span>
  </button>
  <button class="sidebar-btn" data-tab="viper" onclick="switchTab('viper')" title="Viper">
    <span class="sidebar-icon" style="background:var(--agent-viper);">VP</span><span class="sidebar-label">Viper</span>
  </button>
  <div class="sidebar-divider"></div>
  <div class="sidebar-section-label">INFRA</div>
  <button class="sidebar-btn" data-tab="intelligence" onclick="switchTab('intelligence')" title="Intelligence">
    <span class="sidebar-icon" style="background:#9B59B6;">AI</span><span class="sidebar-label">Intelligence</span>
  </button>
  <div class="sidebar-divider"></div>
  <button class="sidebar-btn" data-tab="chat" onclick="switchTab('chat')" title="Chat">
    <span class="sidebar-icon" style="background:#888;">CH</span><span class="sidebar-label">Chat</span>
  </button>
  <div class="sidebar-spacer"></div>
</nav>

<main class="main">
  <header class="header">
    <div class="header-left">
      <h1 class="header-title">Command Center</h1>
      <div class="header-subtitle"><span class="dot-online"></span> <span id="agents-online-count">14</span> Agents Online</div>
    </div>
    <div class="header-right">Last update: <span id="last-update">--:--:--</span></div>
  </header>

  {% include 'tabs/overview.html' %}
  {% include 'tabs/garves_live.html' %}
  {% include 'tabs/soren.html' %}
  {% include 'tabs/shelby.html' %}
  {% include 'tabs/atlas.html' %}
  {% include 'tabs/lisa.html' %}
  {% include 'tabs/robotox.html' %}
  {% include 'tabs/thor.html' %}
  {% include 'tabs/hawk.html' %}
  {% include 'tabs/viper.html' %}
  {% include 'tabs/quant.html' %}
  {% include 'tabs/odin.html' %}
  {% include 'tabs/system.html' %}
  {% include 'tabs/intelligence.html' %}
  {% include 'tabs/chat.html' %}

  <!-- Agent Chat Popup -->
  <div id="agent-chat-popup" class="agent-chat-popup" style="display:none;">
    <div class="agent-chat-header">
      <span id="agent-chat-title">Chat with Agent</span>
      <button onclick="closeAgentChat()" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:1.1rem;">&times;</button>
    </div>
    <div id="agent-chat-messages" class="agent-chat-messages"></div>
    <div class="agent-chat-input-row">
      <input type="text" class="input" id="agent-chat-input" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendAgentChat()" style="flex:1;font-size:0.76rem;padding:6px 10px;">
      <button class="btn btn-primary" onclick="sendAgentChat()" id="agent-chat-send" style="padding:6px 14px;font-size:0.74rem;">Send</button>
    </div>
  </div>

  <!-- Video Modal -->
  <div class="video-modal" id="video-modal">
    <div class="video-modal-inner">
      <video id="modal-video" controls></video>
      <div class="video-modal-btns">
        <button class="btn" id="modal-download-btn">Download</button>
        <button class="btn btn-error" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- KPI Modal -->
  <div class="generic-modal" id="kpi-modal">
    <div class="generic-modal-inner" style="position:relative;">
      <div class="modal-title" id="kpi-modal-title">Performance KPIs</div>
      <div id="kpi-modal-content"><div class="text-muted">Loading...</div></div>
      <div style="margin-top:var(--space-6);text-align:right;">
        <button class="btn btn-error" onclick="closeKPIModal()">Close</button>
      </div>
    </div>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="/static/js/components.js?v=20260220b"></script>
<script src="/static/js/charts.js?v=20260220b"></script>
<script src="/static/dashboard.js?v=20260222b"></script>
<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
<script>
// SocketIO real-time connection (optional â€” degrades gracefully)
(function() {
  if (typeof io === 'undefined') return;
  try {
    var socket = io({transports: ['websocket', 'polling']});
    socket.on('connect', function() {
      console.log('[SocketIO] Connected to Command Center');
      var dot = document.querySelector('.dot-online');
      if (dot) dot.style.background = 'var(--success)';
    });
    socket.on('disconnect', function() {
      console.log('[SocketIO] Disconnected');
    });
    socket.on('heartbeats', function(data) {
      console.log('[SocketIO] Heartbeat push received');
    });
    // Real-time trade alerts
    socket.on('trade_new', function(data) {
      var asset = (data.asset || '?').toUpperCase();
      var dir = (data.direction || '?').toUpperCase();
      var edge = ((data.edge || 0) * 100).toFixed(1);
      var tf = data.timeframe || '';
      showToast('Garves: ' + asset + '/' + tf + ' ' + dir + ' (' + edge + '% edge)', 'trade');
    });
    socket.on('trade_resolved', function(data) {
      var asset = (data.asset || '?').toUpperCase();
      var dir = (data.direction || '?').toUpperCase();
      var pnl = (data.pnl || 0).toFixed(2);
      if (data.won) {
        showToast('WIN: ' + asset + ' ' + dir + ' +$' + pnl, 'success');
      } else {
        showToast('LOSS: ' + asset + ' ' + dir + ' -$' + Math.abs(data.pnl || 0).toFixed(2), 'error');
      }
    });
    socket.on('agent_status', function(data) {
      showToast((data.agent || 'Agent') + ': ' + (data.message || 'status update'), 'info');
    });
    window._ccSocket = socket;
  } catch(e) {
    console.log('[SocketIO] Not available, using polling');
  }
})();
</script>
</body>
</html>
