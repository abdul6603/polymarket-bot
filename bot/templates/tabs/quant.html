<div id="tab-quant" class="tab-content">

  <!-- S1: Header -->
  <div class="qt-header">
    <div class="qt-title-group">
      <span class="qt-title">QUANT</span>
      <span class="qt-subtitle">The Strategy Alchemist</span>
    </div>
    <div class="qt-header-right">
      <span class="qt-status-pill" id="qt-status-pill">
        <span class="qt-status-dot"></span>
        <span id="quant-mode">Historical Replay</span>
      </span>
      <span class="qt-ts">Cycle: <span id="quant-cycle">--</span></span>
      <span class="qt-ts" id="quant-last-update">--</span>
      <button class="qt-action-btn qt-action-primary" onclick="quantTriggerRun()" id="quant-run-btn">Trigger Backtest</button>
      <button class="qt-action-btn" onclick="quantHealthCheck()">Health Check</button>
    </div>
  </div>

  <!-- Progress bar -->
  <div id="quant-progress-bar" class="qt-progress" style="display:none;">
    <div class="qt-progress-top">
      <span class="qt-progress-label" id="quant-progress-label">Running...</span>
      <span class="qt-progress-pct" id="quant-progress-pct">0%</span>
    </div>
    <div class="qt-progress-track">
      <div class="qt-progress-fill" id="quant-progress-fill"></div>
    </div>
    <div class="qt-progress-detail" id="quant-progress-detail"></div>
  </div>

  <!-- S2: Strategy Verdict -->
  <div id="quant-verdict-banner" class="glass-card qt-verdict" style="display:none;">
    <div class="qt-verdict-row">
      <div class="qt-verdict-wr-block">
        <div class="qt-verdict-label">Current WR</div>
        <div class="qt-verdict-wr" id="quant-verdict-current">--</div>
      </div>
      <div class="qt-verdict-arrow">&rarr;</div>
      <div class="qt-verdict-wr-block">
        <div class="qt-verdict-label">Best WR</div>
        <div class="qt-verdict-wr" id="quant-verdict-best">--</div>
      </div>
      <div class="qt-verdict-delta" id="quant-verdict-delta">--</div>
      <div class="qt-verdict-text" id="quant-verdict-text">Loading strategy assessment...</div>
    </div>
  </div>

  <!-- Live Param Override Status -->
  <div id="quant-live-params-card" class="glass-card qt-live-params" style="display:none;">
    <div class="qt-live-params-row">
      <div class="qt-live-params-badge" id="quant-lp-badge">AUTO-PILOT</div>
      <div class="qt-live-params-info">
        <div class="qt-live-params-summary" id="quant-lp-summary">Loading...</div>
        <div class="qt-live-params-detail" id="quant-lp-detail"></div>
      </div>
      <div class="qt-live-params-chips" id="quant-lp-params"></div>
    </div>
  </div>

  <!-- S3: Intelligence Overview -->
  <div class="qt-intel-row">
    <div class="glass-card qt-radar-card">
      <div class="qt-radar-wrap" id="qt-radar-container">
        <div class="qt-radar-placeholder">Loading...</div>
      </div>
      <div class="qt-score-row">
        <span class="qt-score-num" id="qt-score-value">--</span>
        <span class="qt-score-grade" id="qt-score-grade">--</span>
      </div>
      <div class="qt-meta-line">
        Optimizer: <span id="quant-optimizer">--</span>
        &nbsp; Trades: <span id="quant-trade-count">--</span>
        <span id="quant-signal-summary"></span>
      </div>
    </div>
    <div class="qt-stats-col">
      <div class="qt-stat-card" style="border-left-color:var(--agent-quant);">
        <div class="qt-stat-value" id="quant-baseline-wr">--</div>
        <div class="qt-stat-label">Current WR</div>
      </div>
      <div class="qt-stat-card" style="border-left-color:var(--success);">
        <div class="qt-stat-value" id="quant-wf-oos">--</div>
        <div class="qt-stat-label">OOS WR</div>
      </div>
      <div class="qt-stat-card" style="border-left-color:var(--warning);">
        <div class="qt-stat-value" id="quant-kelly">--</div>
        <div class="qt-stat-label">Kelly Size</div>
      </div>
      <div class="qt-stat-card" style="border-left-color:#3498DB;">
        <div class="qt-stat-value" id="quant-decay-status">--</div>
        <div class="qt-stat-label">Strategy Health</div>
      </div>
      <div class="qt-stat-card" style="border-left-color:var(--text-muted);">
        <div class="qt-stat-value" id="quant-trades">--</div>
        <div class="qt-stat-label">Trades</div>
      </div>
    </div>
  </div>

  <!-- Health check result -->
  <div class="health-inline" id="quant-health-result"></div>

  <!-- S4: Quick Actions -->
  <div class="glass-card qt-actions-card">
    <div class="qt-actions-header">
      <span class="qt-section-label">QUICK ACTIONS</span>
      <span id="qt-action-status" class="qt-action-feedback"></span>
    </div>
    <div class="qt-actions-grid">
      <button class="qt-action-btn" onclick="quantApplyParams()">
        <span class="qt-action-icon" style="background:rgba(0,255,136,0.12);color:var(--success);">&#x2713;</span>
        Apply Best Params
      </button>
      <button class="qt-action-btn" onclick="quantRollbackParams()">
        <span class="qt-action-icon" style="background:rgba(255,68,68,0.12);color:var(--error);">&#x21B6;</span>
        Rollback Params
      </button>
      <button class="qt-action-btn" onclick="loadQuantPhase2()">
        <span class="qt-action-icon" style="background:rgba(255,170,0,0.12);color:var(--warning);">&#x2696;</span>
        Regime Check
      </button>
      <button class="qt-action-btn" onclick="loadQuantPhase2()">
        <span class="qt-action-icon" style="background:rgba(0,191,255,0.12);color:#00BFFF;">&#x2194;</span>
        Correlation Scan
      </button>
      <button class="qt-action-btn" onclick="document.getElementById('qt-panel-pnl').classList.add('open');loadQuantPNLImpact();">
        <span class="qt-action-icon" style="background:rgba(139,92,246,0.12);color:#8B5CF6;">&#x24;</span>
        PNL Impact
      </button>
      <button class="qt-action-btn" onclick="quantExportReport()">
        <span class="qt-action-icon" style="background:rgba(136,136,170,0.12);color:#8888aa;">&#x2913;</span>
        Export Report
      </button>
    </div>
  </div>

  <!-- S5: Smart Actions -->
  <div class="glass-card qt-smart-section">
    <div class="qt-section-header">
      <span class="qt-section-label">SMART ACTIONS</span>
      <button class="qt-refresh-btn" onclick="loadQuantSmartActions()">Refresh</button>
    </div>
    <div id="quant-smart-actions" class="qt-smart-actions-wrap">
      <span class="qt-placeholder">Loading...</span>
    </div>
  </div>

  <!-- S6: Phase Panels (open by default) -->

  <!-- Phase 1: Triple Gate Validation -->
  <div class="collapse-section qt-panel open">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#00BFFF;"></span>
        <h2 class="qt-panel-title">Triple Gate Validation</h2>
        <span class="qt-panel-sub">Phase 1</span>
        <span class="qt-panel-badge" id="qt-phase1-badge"></span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body">
        <div class="qt-phase-grid">
          <!-- WFV2 -->
          <div class="qt-phase-card">
            <div class="qt-phase-card-header">
              <span class="qt-phase-card-title">Walk-Forward V2</span>
              <span class="qt-phase-card-badge" id="quant-wfv2-badge">--</span>
            </div>
            <div class="qt-phase-card-grid">
              <div class="qt-phase-lbl">Overfit Gap:</div><div id="quant-wfv2-gap">--</div>
              <div class="qt-phase-lbl">Stability:</div><div id="quant-wfv2-stability">--</div>
              <div class="qt-phase-lbl">PNL/day:</div><div id="quant-wfv2-pnl">--</div>
              <div class="qt-phase-lbl">Method:</div><div id="quant-wfv2-method">--</div>
            </div>
          </div>
          <!-- Monte Carlo -->
          <div class="qt-phase-card">
            <div class="qt-phase-card-header">
              <span class="qt-phase-card-title">Monte Carlo (10K sims)</span>
              <span class="qt-phase-card-badge" id="quant-mc-badge">--</span>
            </div>
            <div class="qt-phase-card-grid">
              <div class="qt-phase-lbl">Ruin Prob:</div><div id="quant-mc-ruin">--</div>
              <div class="qt-phase-lbl">Avg Drawdown:</div><div id="quant-mc-dd">--</div>
              <div class="qt-phase-lbl">Sharpe:</div><div id="quant-mc-sharpe">--</div>
              <div class="qt-phase-lbl">Profitable:</div><div id="quant-mc-profitable">--</div>
            </div>
          </div>
          <!-- CUSUM -->
          <div class="qt-phase-card">
            <div class="qt-phase-card-header">
              <span class="qt-phase-card-title">CUSUM Edge Decay</span>
              <span class="qt-phase-card-badge" id="quant-cusum-badge">--</span>
            </div>
            <div class="qt-phase-card-grid">
              <div class="qt-phase-lbl">Severity:</div><div id="quant-cusum-severity">--</div>
              <div class="qt-phase-lbl">Rolling WR:</div><div id="quant-cusum-wr">--</div>
              <div class="qt-phase-lbl">WR Drop:</div><div id="quant-cusum-drop">--</div>
              <div class="qt-phase-lbl">Since Change:</div><div id="quant-cusum-since">--</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase 2: Intelligence -->
  <div class="collapse-section qt-panel open">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#22cc55;"></span>
        <h2 class="qt-panel-title">Intelligence</h2>
        <span class="qt-panel-sub">Phase 2</span>
        <span class="qt-panel-badge" id="qt-phase2-badge"></span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body">
        <div class="qt-phase-grid">
          <!-- Regime -->
          <div class="qt-phase-card">
            <div class="qt-phase-card-header">
              <span class="qt-phase-card-title">Regime Detection</span>
            </div>
            <div class="qt-phase-card-grid">
              <div class="qt-phase-lbl">Current:</div><div id="quant-regime-current">--</div>
              <div class="qt-phase-lbl">Best Regime:</div><div id="quant-regime-best">--</div>
              <div class="qt-phase-lbl">Worst Regime:</div><div id="quant-regime-worst">--</div>
              <div class="qt-phase-lbl">Regimes Found:</div><div id="quant-regime-count">--</div>
            </div>
            <div class="qt-phase-card-extra" id="quant-regime-perf"></div>
          </div>
          <!-- Correlation -->
          <div class="qt-phase-card">
            <div class="qt-phase-card-header">
              <span class="qt-phase-card-title">Correlation Guard</span>
              <span class="qt-phase-card-badge" id="quant-corr-badge">--</span>
            </div>
            <div class="qt-phase-card-grid">
              <div class="qt-phase-lbl">Risk Level:</div><div id="quant-corr-risk">--</div>
              <div class="qt-phase-lbl">Direct Overlaps:</div><div id="quant-corr-direct">--</div>
              <div class="qt-phase-lbl">Correlated:</div><div id="quant-corr-correlated">--</div>
              <div class="qt-phase-lbl">Combined $:</div><div id="quant-corr-exposure">--</div>
            </div>
            <div class="qt-phase-card-extra" id="quant-corr-alert"></div>
          </div>
          <!-- Self-Learning -->
          <div class="qt-phase-card">
            <div class="qt-phase-card-header">
              <span class="qt-phase-card-title">Self-Learning</span>
            </div>
            <div class="qt-phase-card-grid">
              <div class="qt-phase-lbl">Accuracy:</div><div id="quant-learn-accuracy">--</div>
              <div class="qt-phase-lbl">Recs Tracked:</div><div id="quant-learn-recs">--</div>
              <div class="qt-phase-lbl">Combined WR:</div><div id="quant-learn-combined-wr">--</div>
              <div class="qt-phase-lbl">Odin Trades:</div><div id="quant-learn-odin">--</div>
            </div>
            <div class="qt-phase-card-extra" id="quant-learn-insights"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase 3: PNL Impact Estimator -->
  <div class="collapse-section qt-panel open" id="qt-panel-pnl">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#8B5CF6;"></span>
        <h2 class="qt-panel-title">PNL Impact Estimator</h2>
        <span class="qt-panel-sub">Phase 3</span>
        <span class="qt-panel-badge" id="qt-phase3-badge"></span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body" id="quant-pnl-impact-card">
        <div class="qt-pnl-stats">
          <div class="qt-stat-card" style="border-left-color:var(--agent-quant);">
            <div class="qt-stat-value" id="quant-pnl-daily">--</div>
            <div class="qt-stat-label">Daily PNL</div>
          </div>
          <div class="qt-stat-card" style="border-left-color:var(--success);">
            <div class="qt-stat-value" id="quant-pnl-monthly">--</div>
            <div class="qt-stat-label">Monthly PNL</div>
          </div>
          <div class="qt-stat-card" style="border-left-color:var(--warning);">
            <div class="qt-stat-value" id="quant-pnl-wr-delta">--</div>
            <div class="qt-stat-label">WR Change</div>
          </div>
          <div class="qt-stat-card" style="border-left-color:var(--text-muted);">
            <div class="qt-stat-value" id="quant-pnl-net-trades">--</div>
            <div class="qt-stat-label">Net Trades</div>
          </div>
        </div>
        <div class="qt-pnl-breakdown">
          <div id="quant-pnl-by-asset"></div>
          <div id="quant-pnl-attribution"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Per-Trade Learning -->
  <div class="collapse-section qt-panel" id="quant-learning-card">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#FFD700;"></span>
        <h2 class="qt-panel-title">Per-Trade Learning</h2>
        <span class="qt-panel-sub">Continuous</span>
        <span class="qt-panel-badge" id="quant-learn-total">--</span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body">
        <div class="qt-learn-grid">
          <div class="qt-stat-card" style="border-left-color:var(--agent-quant);">
            <div class="qt-stat-value" id="quant-learn-studied">--</div>
            <div class="qt-stat-label">Trades Studied</div>
          </div>
          <div class="qt-stat-card" style="border-left-color:var(--success);">
            <div class="qt-stat-value" id="quant-learn-filter">--</div>
            <div class="qt-stat-label">Filter Correctness</div>
          </div>
          <div class="qt-stat-card" style="border-left-color:var(--warning);">
            <div class="qt-stat-value" id="quant-learn-ind-acc">--</div>
            <div class="qt-stat-label">Avg Indicator Acc</div>
          </div>
          <div class="qt-stat-card" style="border-left-color:#8B5CF6;">
            <div class="qt-stat-value" id="quant-learn-mini-opts">--</div>
            <div class="qt-stat-label">Mini-Opts Run</div>
          </div>
        </div>
        <div class="qt-learn-chips" id="quant-learn-indicators"></div>
        <div class="qt-learn-mini-opt" id="quant-learn-mini-opt-summary" style="display:none;"></div>
        <div class="qt-learn-feed" id="quant-learn-recent">
          <div class="qt-placeholder">No studies yet</div>
        </div>
      </div>
    </div>
  </div>

  <!-- S7: Deep Dive Panels (closed by default) -->

  <!-- What to Change -->
  <div class="collapse-section qt-panel">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#ff6600;"></span>
        <h2 class="qt-panel-title">What to Change</h2>
        <span class="qt-panel-sub">Parameters: current vs optimal</span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body">
        <table class="data-table">
          <thead><tr><th>Parameter</th><th>Now</th><th>Optimal</th><th>Status</th></tr></thead>
          <tbody id="quant-params-tbody">
            <tr><td colspan="4" class="qt-placeholder">Run a backtest to see comparison</td></tr>
          </tbody>
        </table>
        <div id="quant-recommendations" class="qt-recs-area">
          <div class="qt-placeholder">Recommendations appear after backtesting</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Walk-Forward Validation -->
  <div class="collapse-section qt-panel">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#3498DB;"></span>
        <h2 class="qt-panel-title">Walk-Forward Validation</h2>
        <span class="qt-panel-sub">Does the strategy work on unseen data?</span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body">
        <table class="data-table">
          <thead><tr><th>Fold</th><th>Train</th><th>Train WR</th><th>Test</th><th>Test WR</th><th>Status</th></tr></thead>
          <tbody id="quant-wf-tbody">
            <tr><td colspan="6" class="qt-placeholder">Run a backtest to see walk-forward results</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Position Sizing & Strategy Health -->
  <div class="collapse-section qt-panel">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:var(--success);"></span>
        <h2 class="qt-panel-title">Position Sizing &amp; Strategy Health</h2>
        <span class="qt-panel-sub">How much to bet and decay detection</span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body" id="quant-analytics-detail">
        <div class="qt-placeholder">No analytics data yet</div>
      </div>
    </div>
  </div>

  <!-- Parameter Sensitivity: Consensus -->
  <div class="collapse-section qt-panel">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:var(--warning);"></span>
        <h2 class="qt-panel-title">Parameter Sensitivity</h2>
        <span class="qt-panel-sub">Consensus &amp; Edge thresholds</span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body">
        <div class="qt-sensitivity-grid">
          <div>
            <div class="qt-phase-card-title" style="margin-bottom:8px;">Consensus Sensitivity</div>
            <table class="data-table">
              <thead><tr><th>Min Consensus</th><th>Avg WR</th><th>Avg Signals</th><th>Combos</th></tr></thead>
              <tbody id="quant-consensus-tbody">
                <tr><td colspan="4" class="qt-placeholder">--</td></tr>
              </tbody>
            </table>
          </div>
          <div>
            <div class="qt-phase-card-title" style="margin-bottom:8px;">Edge Sensitivity</div>
            <table class="data-table">
              <thead><tr><th>Min Edge</th><th>Avg WR</th><th>Avg Signals</th><th>Combos</th></tr></thead>
              <tbody id="quant-edge-tbody">
                <tr><td colspan="4" class="qt-placeholder">--</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Indicator Diversity -->
  <div class="collapse-section qt-panel">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#cc66ff;"></span>
        <h2 class="qt-panel-title">Indicator Diversity</h2>
        <span class="qt-panel-sub">Are indicators independent or echoing each other?</span>
        <span class="qt-panel-badge" id="quant-diversity-badge"></span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body" id="quant-diversity-detail">
        <div class="qt-placeholder">No diversity data yet</div>
      </div>
    </div>
  </div>

  <!-- Top Backtest Results -->
  <div class="collapse-section qt-panel">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:var(--agent-quant);"></span>
        <h2 class="qt-panel-title">Top Backtest Results</h2>
        <span class="qt-panel-sub">Best parameter combos ranked by score (top 10)</span>
        <span class="qt-panel-badge" id="quant-best-wr"></span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body">
        <table class="data-table">
          <thead><tr><th>#</th><th>Label</th><th>Score</th><th>Win Rate</th><th>PF</th><th>Signals</th><th>W/L</th><th>Avg Edge</th></tr></thead>
          <tbody id="quant-results-tbody">
            <tr><td colspan="8" class="qt-placeholder">No results yet â€” trigger a backtest</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Hawk Trade Review -->
  <div class="collapse-section qt-panel">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:var(--agent-hawk);"></span>
        <h2 class="qt-panel-title">Hawk Trade Review</h2>
        <span class="qt-panel-sub">Quant analysis of Hawk trading patterns</span>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body" id="quant-hawk-review">
        <div class="qt-placeholder">No Hawk data available</div>
      </div>
    </div>
  </div>

  <!-- Version History -->
  <div class="collapse-section qt-panel" id="quant-version-history" style="display:none;">
    <div class="collapse-trigger">
      <div class="qt-panel-hdr-row">
        <span class="qt-panel-dot" style="background:#00d4ff;"></span>
        <h2 class="qt-panel-title">Strategy Version History</h2>
      </div>
    </div>
    <div class="collapse-body">
      <div class="qt-panel-body" id="quant-versions-list"></div>
    </div>
  </div>

  <!-- Hidden compat elements -->
  <div style="display:none;">
    <span id="quant-total-combos">--</span>
    <span id="quant-ci">--</span>
    <span id="quant-avg-edge">--</span>
    <span id="quant-filtered">--</span>
    <span id="quant-overfit">--</span>
    <span id="quant-diversity">--</span>
    <span id="quant-pnl-badge">--</span>
  </div>

</div>
