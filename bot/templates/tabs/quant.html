<div id="tab-quant" class="tab-content">
  <div id="intel-quant" class="intel-meter" style="margin-bottom:12px;"></div>

  <!-- Agent Badge Row -->
  <div class="d-flex align-center gap-3 mb-4">
    <div class="agent-card-initial" style="background:#00BFFF22;color:#00BFFF;font-size:1.1rem;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:10px;">QT</div>
    <div>
      <div style="font-weight:600;color:var(--text-primary);">Quant — The Strategy Alchemist</div>
      <div class="text-muted" style="font-size:0.72rem;">Strategy Lab | Mode: <span id="quant-mode">Historical Replay</span> | Cycle: <span id="quant-cycle">--</span> | Optimizer: <span id="quant-optimizer" style="color:#00BFFF;">--</span> | Trades: <span id="quant-trade-count" style="color:#00BFFF;font-weight:600;">--</span> <span id="quant-signal-summary" style="color:var(--text-muted);"></span></div>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;">
      <button class="btn btn-primary" onclick="quantTriggerRun()" id="quant-run-btn" style="font-size:0.72rem;padding:6px 14px;">Trigger Backtest</button>
      <button class="btn" onclick="quantHealthCheck()" style="font-size:0.72rem;padding:6px 14px;">Health Check</button>
</div>
  </div>

  <!-- Progress bar (hidden by default) -->
  <div id="quant-progress-bar" style="display:none;margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
      <span class="text-muted" style="font-size:0.7rem;" id="quant-progress-label">Running...</span>
      <span class="text-muted" style="font-size:0.7rem;" id="quant-progress-pct">0%</span>
    </div>
    <div style="background:var(--card-bg);border-radius:4px;height:6px;overflow:hidden;">
      <div id="quant-progress-fill" style="background:#00BFFF;height:100%;width:0%;transition:width 0.3s;border-radius:4px;"></div>
    </div>
    <div class="text-muted" style="font-size:0.65rem;margin-top:2px;" id="quant-progress-detail"></div>
  </div>

  <!-- Strategy Verdict Banner -->
  <div id="quant-verdict-banner" style="background:var(--card-bg);border:2px solid var(--border);border-radius:12px;padding:20px 24px;margin-bottom:16px;display:none;">
    <div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap;">
      <div style="text-align:center;min-width:80px;">
        <div class="text-muted" style="font-size:0.65rem;margin-bottom:2px;">Current WR</div>
        <div id="quant-verdict-current" style="font-size:1.8rem;font-weight:700;">--</div>
      </div>
      <div style="font-size:1.6rem;color:var(--text-muted);">&rarr;</div>
      <div style="text-align:center;min-width:80px;">
        <div class="text-muted" style="font-size:0.65rem;margin-bottom:2px;">Best WR</div>
        <div id="quant-verdict-best" style="font-size:1.8rem;font-weight:700;">--</div>
      </div>
      <div id="quant-verdict-delta" style="font-size:1.2rem;font-weight:700;padding:6px 14px;border-radius:8px;">--</div>
      <div style="flex:1;min-width:200px;margin-left:12px;">
        <div id="quant-verdict-text" style="font-size:0.82rem;font-weight:500;line-height:1.4;color:var(--text-secondary);">Loading strategy assessment...</div>
      </div>
    </div>
  </div>

  <!-- Live Param Override Status -->
  <div id="quant-live-params-card" style="display:none;background:var(--card-bg);border:1px solid #00BFFF44;border-radius:10px;padding:14px 18px;margin-bottom:16px;">
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      <div id="quant-lp-badge" style="font-size:0.68rem;font-weight:600;padding:3px 10px;border-radius:6px;background:#00BFFF22;color:#00BFFF;">AUTO-PILOT</div>
      <div style="flex:1;min-width:200px;">
        <div id="quant-lp-summary" style="font-size:0.78rem;font-weight:500;color:var(--text-primary);">Loading...</div>
        <div id="quant-lp-detail" style="font-size:0.65rem;color:var(--text-muted);margin-top:2px;"></div>
      </div>
      <div id="quant-lp-params" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
    </div>
  </div>

  <!-- Per-Trade Learning Card -->
  <div id="quant-learning-card" style="display:none;background:var(--card-bg);border:1px solid rgba(0,191,255,0.2);border-radius:10px;padding:16px 20px;margin-bottom:16px;">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
      <div style="font-size:0.68rem;font-weight:600;padding:3px 10px;border-radius:6px;background:#00BFFF22;color:#00BFFF;">PER-TRADE LEARNING</div>
      <div style="flex:1;"></div>
      <span id="quant-learn-total" class="text-muted" style="font-size:0.65rem;">--</span>
    </div>
    <div class="grid-4" style="margin-bottom:12px;">
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">Trades Studied</div>
        <div class="stat-value" id="quant-learn-studied" style="font-size:1.1rem;color:#00BFFF;">--</div>
      </div>
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">Filter Correctness</div>
        <div class="stat-value" id="quant-learn-filter" style="font-size:1.1rem;">--</div>
      </div>
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">Avg Indicator Acc</div>
        <div class="stat-value" id="quant-learn-ind-acc" style="font-size:1.1rem;">--</div>
      </div>
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">Mini-Opts Run</div>
        <div class="stat-value" id="quant-learn-mini-opts" style="font-size:1.1rem;color:#00BFFF;">--</div>
      </div>
    </div>
    <div id="quant-learn-indicators" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px;"></div>
    <div id="quant-learn-mini-opt-summary" style="display:none;font-size:0.72rem;color:var(--text-secondary);padding:8px 10px;background:rgba(0,191,255,0.04);border-radius:6px;margin-bottom:10px;"></div>
    <div id="quant-learn-recent" style="max-height:180px;overflow-y:auto;">
      <div class="text-muted" style="font-size:0.7rem;text-align:center;">No studies yet</div>
    </div>
  </div>

  <!-- Smart Actions (moved after verdict for visibility) -->
  <div class="section-spacer" style="margin-top:0;margin-bottom:16px;">
    <h2 class="section-title" style="color:#00BFFF;">Suggested Actions</h2>
    <div id="quant-smart-actions" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px;"><span class="text-muted" style="font-size:0.76rem;">Loading...</span></div>
  </div>

  <!-- Key Numbers Row 1: Performance -->
  <div class="grid-4" style="margin-bottom:12px;">
    <div class="stat-card">
      <div class="stat-label">Current Live WR</div>
      <div class="stat-value" id="quant-baseline-wr" style="color:var(--warning);">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Best WR Found</div>
      <div class="stat-value" id="quant-best-wr" style="color:var(--success);">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Out-of-Sample WR</div>
      <div class="stat-value" id="quant-wf-oos" style="color:var(--warning);">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Overfit Gap</div>
      <div class="stat-value" id="quant-overfit">--</div>
    </div>
  </div>

  <!-- Key Numbers Row 2: Sizing & Health -->
  <div class="grid-4" style="margin-bottom:20px;">
    <div class="stat-card">
      <div class="stat-label">Kelly Size</div>
      <div class="stat-value" id="quant-kelly" style="color:#00BFFF;">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Diversity</div>
      <div class="stat-value" id="quant-diversity" style="color:var(--success);">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Strategy Health</div>
      <div class="stat-value" id="quant-decay-status" style="font-size:0.85rem;">--</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Trades Analyzed</div>
      <div class="stat-value" id="quant-trades" style="color:var(--text-muted);">--</div>
    </div>
  </div>

  <!-- Phase 1: Triple Gate Validation -->
  <div style="margin-bottom:16px;">
    <h2 class="section-title" style="color:#00BFFF;">Phase 1 — Triple Gate Validation</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
      <!-- WFV2 -->
      <div class="card" style="padding:14px 16px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
          <span style="font-weight:600;font-size:0.78rem;color:#00BFFF;">Walk-Forward V2</span>
          <span id="quant-wfv2-badge" style="font-size:0.62rem;font-weight:600;padding:2px 8px;border-radius:4px;background:rgba(255,170,0,0.13);color:var(--warning);">--</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.7rem;">
          <div class="text-muted">Overfit Gap:</div><div id="quant-wfv2-gap">--</div>
          <div class="text-muted">Stability:</div><div id="quant-wfv2-stability">--</div>
          <div class="text-muted">PNL/day:</div><div id="quant-wfv2-pnl">--</div>
          <div class="text-muted">Method:</div><div id="quant-wfv2-method">--</div>
        </div>
      </div>
      <!-- Monte Carlo -->
      <div class="card" style="padding:14px 16px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
          <span style="font-weight:600;font-size:0.78rem;color:#00BFFF;">Monte Carlo (10K sims)</span>
          <span id="quant-mc-badge" style="font-size:0.62rem;font-weight:600;padding:2px 8px;border-radius:4px;background:rgba(255,170,0,0.13);color:var(--warning);">--</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.7rem;">
          <div class="text-muted">Ruin Prob:</div><div id="quant-mc-ruin">--</div>
          <div class="text-muted">Avg Drawdown:</div><div id="quant-mc-dd">--</div>
          <div class="text-muted">Sharpe:</div><div id="quant-mc-sharpe">--</div>
          <div class="text-muted">Profitable:</div><div id="quant-mc-profitable">--</div>
        </div>
      </div>
      <!-- CUSUM -->
      <div class="card" style="padding:14px 16px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
          <span style="font-weight:600;font-size:0.78rem;color:#00BFFF;">CUSUM Edge Decay</span>
          <span id="quant-cusum-badge" style="font-size:0.62rem;font-weight:600;padding:2px 8px;border-radius:4px;background:rgba(255,170,0,0.13);color:var(--warning);">--</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.7rem;">
          <div class="text-muted">Severity:</div><div id="quant-cusum-severity">--</div>
          <div class="text-muted">Rolling WR:</div><div id="quant-cusum-wr">--</div>
          <div class="text-muted">WR Drop:</div><div id="quant-cusum-drop">--</div>
          <div class="text-muted">Since Change:</div><div id="quant-cusum-since">--</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase 2: Intelligence -->
  <div style="margin-bottom:16px;">
    <h2 class="section-title" style="color:#00BFFF;">Phase 2 — Intelligence</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
      <!-- Regime -->
      <div class="card" style="padding:14px 16px;">
        <div style="font-weight:600;font-size:0.78rem;color:#00BFFF;margin-bottom:10px;">Regime Detection</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.7rem;">
          <div class="text-muted">Current:</div><div id="quant-regime-current">--</div>
          <div class="text-muted">Best Regime:</div><div id="quant-regime-best" style="color:var(--success);">--</div>
          <div class="text-muted">Worst Regime:</div><div id="quant-regime-worst" style="color:var(--error);">--</div>
          <div class="text-muted">Regimes Found:</div><div id="quant-regime-count">--</div>
        </div>
        <div id="quant-regime-perf" style="margin-top:8px;"></div>
      </div>
      <!-- Correlation -->
      <div class="card" style="padding:14px 16px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
          <span style="font-weight:600;font-size:0.78rem;color:#00BFFF;">Correlation Guard</span>
          <span id="quant-corr-badge" style="font-size:0.62rem;font-weight:600;padding:2px 8px;border-radius:4px;">--</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.7rem;">
          <div class="text-muted">Risk Level:</div><div id="quant-corr-risk">--</div>
          <div class="text-muted">Direct Overlaps:</div><div id="quant-corr-direct">--</div>
          <div class="text-muted">Correlated:</div><div id="quant-corr-correlated">--</div>
          <div class="text-muted">Combined $:</div><div id="quant-corr-exposure">--</div>
        </div>
        <div id="quant-corr-alert" style="margin-top:8px;font-size:0.68rem;color:var(--text-muted);"></div>
      </div>
      <!-- Self-Learning -->
      <div class="card" style="padding:14px 16px;">
        <div style="font-weight:600;font-size:0.78rem;color:#00BFFF;margin-bottom:10px;">Self-Learning</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.7rem;">
          <div class="text-muted">Accuracy:</div><div id="quant-learn-accuracy">--</div>
          <div class="text-muted">Recs Tracked:</div><div id="quant-learn-recs">--</div>
          <div class="text-muted">Combined WR:</div><div id="quant-learn-combined-wr">--</div>
          <div class="text-muted">Odin Trades:</div><div id="quant-learn-odin">--</div>
        </div>
        <div id="quant-learn-insights" style="margin-top:8px;"></div>
      </div>
    </div>
  </div>

  <!-- Phase 3: PNL Impact Estimator -->
  <div id="quant-pnl-impact-card" style="display:none;background:var(--card-bg);border:1px solid #00BFFF44;border-radius:10px;padding:16px 20px;margin-bottom:16px;">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
      <span style="font-weight:600;font-size:0.82rem;color:#00BFFF;">PNL Impact Estimator</span>
      <span id="quant-pnl-badge" style="font-size:0.68rem;font-weight:600;padding:3px 10px;border-radius:6px;"></span>
    </div>
    <div class="grid-4" style="margin-bottom:12px;">
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">Daily PNL</div>
        <div class="stat-value" id="quant-pnl-daily" style="font-size:1.1rem;color:#00BFFF;">--</div>
      </div>
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">Monthly PNL</div>
        <div class="stat-value" id="quant-pnl-monthly" style="font-size:1.1rem;">--</div>
      </div>
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">WR Change</div>
        <div class="stat-value" id="quant-pnl-wr-delta" style="font-size:1.1rem;">--</div>
      </div>
      <div class="stat-card" style="padding:8px 10px;">
        <div class="stat-label" style="font-size:0.6rem;">Net Trades</div>
        <div class="stat-value" id="quant-pnl-net-trades" style="font-size:1.1rem;">--</div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div id="quant-pnl-by-asset" style="font-size:0.7rem;"></div>
      <div id="quant-pnl-attribution" style="font-size:0.7rem;"></div>
    </div>
  </div>

  <!-- Version History -->
  <div id="quant-version-history" style="display:none;margin-bottom:16px;">
    <div class="card" style="padding:14px 16px;">
      <div style="font-weight:600;font-size:0.78rem;color:#00BFFF;margin-bottom:10px;">Strategy Version History</div>
      <div id="quant-versions-list" style="font-size:0.7rem;"></div>
    </div>
  </div>

  <!-- What To Change (merged params + recommendations) -->
  <div class="card" style="margin-bottom:20px;">
    <div class="card-header">What To Change <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">Parameters: current vs backtest optimal</span></div>
    <table class="table">
      <thead><tr><th>Parameter</th><th>Now</th><th>Optimal</th><th>Status</th></tr></thead>
      <tbody id="quant-params-tbody">
        <tr><td colspan="4" class="text-muted" style="text-align:center;padding:20px;">Run a backtest to see comparison</td></tr>
      </tbody>
    </table>
    <div id="quant-recommendations" style="padding:8px 12px;">
      <div class="text-muted" style="text-align:center;padding:8px;font-size:0.72rem;">Recommendations appear after backtesting</div>
    </div>
  </div>

  <!-- Walk-Forward Validation + Position Sizing & Strategy Health -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <div class="card">
      <div class="card-header">Walk-Forward Validation <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">Does the strategy work on unseen data?</span></div>
      <table class="table">
        <thead><tr><th>Fold</th><th>Train</th><th>Train WR</th><th>Test</th><th>Test WR</th><th>Status</th></tr></thead>
        <tbody id="quant-wf-tbody">
          <tr><td colspan="6" class="text-muted" style="text-align:center;padding:20px;">Run a backtest to see walk-forward results</td></tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <div class="card-header">Position Sizing &amp; Strategy Health <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">How much to bet and decay detection</span></div>
      <div id="quant-analytics-detail" style="padding:12px;">
        <div class="text-muted" style="text-align:center;padding:20px;">No analytics data yet</div>
      </div>
    </div>
  </div>

  <!-- Parameter Sensitivity -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
    <div class="card">
      <div class="card-header">Consensus Sensitivity <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">WR at different agreement thresholds</span></div>
      <table class="table">
        <thead><tr><th>Min Consensus</th><th>Avg WR</th><th>Avg Signals</th><th>Combos</th></tr></thead>
        <tbody id="quant-consensus-tbody">
          <tr><td colspan="4" class="text-muted" style="text-align:center;">--</td></tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <div class="card-header">Edge Sensitivity <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">WR at different minimum edge levels</span></div>
      <table class="table">
        <thead><tr><th>Min Edge</th><th>Avg WR</th><th>Avg Signals</th><th>Combos</th></tr></thead>
        <tbody id="quant-edge-tbody">
          <tr><td colspan="4" class="text-muted" style="text-align:center;">--</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Indicator Diversity -->
  <div class="card" style="margin-bottom:20px;">
    <div class="card-header">Indicator Diversity <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">Are indicators independent or echoing each other?</span></div>
    <div id="quant-diversity-detail" style="padding:12px;">
      <div class="text-muted" style="text-align:center;padding:20px;">No diversity data yet</div>
    </div>
  </div>

  <!-- Top Backtest Results -->
  <div class="card" style="margin-bottom:20px;">
    <div class="card-header">Top Backtest Results <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">Best parameter combos ranked by score (top 10)</span></div>
    <table class="table">
      <thead><tr><th>#</th><th>Label</th><th>Score</th><th>Win Rate</th><th>PF</th><th>Signals</th><th>W/L</th><th>Avg Edge</th></tr></thead>
      <tbody id="quant-results-tbody">
        <tr><td colspan="8" class="text-muted" style="text-align:center;padding:20px;">No results yet — trigger a backtest</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Hawk Trade Review -->
  <div class="card" style="margin-bottom:20px;">
    <div class="card-header">Hawk Trade Review <span class="text-muted" style="font-size:0.65rem;font-weight:400;margin-left:6px;">Quant's analysis of Hawk's trading patterns</span></div>
    <div id="quant-hawk-review" style="padding:12px;">
      <div class="text-muted" style="text-align:center;padding:20px;">No Hawk data available</div>
    </div>
  </div>

  <!-- Hidden elements for JS compatibility (removed from visible layout) -->
  <div style="display:none;">
    <span id="quant-total-combos">--</span>
    <span id="quant-ci">--</span>
    <span id="quant-avg-edge">--</span>
    <span id="quant-filtered">--</span>
  </div>

  <!-- Last updated -->
  <div class="text-muted" style="font-size:0.65rem;margin-top:12px;text-align:right;">
    Last update: <span id="quant-last-update">--</span>
  </div>
</div>
